assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
},{print(110)
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
return(get(paste0("result_",q)))
})
<- "CPI"
tryCatch({  assign(paste0("result_",q),
smbinning(df=X_train,y='isdefault',x=q,p=0.01))
result <- get(paste0("result_",q))
print(000)
if((result[1]=="uniques values of x<10") | (result[1]=="No significant splits"))
{
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
},print(110)
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
)
rm(result_CPI)
q <- "CPI"
tryCatch({  assign(paste0("result_",q),
smbinning(df=X_train,y='isdefault',x=q,p=0.01))
result <- get(paste0("result_",q))
print(000)
if((result[1]=="uniques values of x<10") | (result[1]=="No significant splits"))
{
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
},{print(110)
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
)
q <- "alhpa"
tryCatch({  assign(paste0("result_",q),
smbinning(df=X_train,y='isdefault',x=q,p=0.01))
result <- get(paste0("result_",q))
print(000)
if((result[1]=="uniques values of x<10") | (result[1]=="No significant splits"))
{
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
},
print(110)
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
)
q <- "alpha"
tryCatch({  assign(paste0("result_",q),
smbinning(df=X_train,y='isdefault',x=q,p=0.01))
result <- get(paste0("result_",q))
print(000)
if((result[1]=="uniques values of x<10") | (result[1]=="No significant splits"))
{
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
},
print(110)
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
)
var_quant_optimal <- c('alhpa' ,'belta' ,'belta_yj' ,'consumption' ,'finance_4' ,'finance_8' ,'finance_9','finance_13')
var_quant_other <- setdiff(var_quant,var_quant_optimal)
var_quant_other
var_quant
var_quant_other
var_quant_optimal <- c('alpha' ,'belta' ,'belta_yj' ,'consumption' ,'finance_4' ,'finance_8' ,'finance_9','finance_13')
var_quant_other <- setdiff(var_quant,var_quant_optimal)
var_quant_other
for (q in var_quant_optimal)
{
assign(paste0("result_",q),smbinning(df=X_train,y='isdefault',x=q,p=0.01))
}
for (q in var_quant_optimal[1:5])
{
assign(paste0("result_",q),smbinning(df=X_train,y='isdefault',x=q,p=0.01))
}
for (q in var_quant_optimal[1])
{
assign(paste0("result_",q),smbinning(df=X_train,y='isdefault',x=q,p=0.01))
}
for (q in var_quant_optimal[2])
{
assign(paste0("result_",q),smbinning(df=X_train,y='isdefault',x=q,p=0.01))
}
for (q in var_quant_optimal[3])
{
assign(paste0("result_",q),smbinning(df=X_train,y='isdefault',x=q,p=0.01))
}
for (q in var_quant_optimal[4])
{
assign(paste0("result_",q),smbinning(df=X_train,y='isdefault',x=q,p=0.01))
}
result_consumption
var_quant <- c('CPI','ChinaNewsBasedEPU','GDP','alpha','belta','belta_yj','belta_yz','consumption','creditspread','finance_1','finance_2','finance_3','finance_4','finance_5','finance_6','finance_7','finance_8','finance_9','finance_10','finance_11','finance_12','finance_13','finance_14','finance_15')
var_quant_optimal <- c('alpha' ,'belta' ,'belta_yj'  ,'finance_4' ,'finance_8' ,'finance_9','finance_13')
for (q in var_quant_optimal)
{
assign(paste0("result_",q),smbinning(df=X_train,y='isdefault',x=q,p=0.01))
}
var_quant_other <- setdiff(var_quant,var_quant_optimal)
for (q2 in var_quant_other)
{
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
var_quant_other
for (q in var_quant_other)
{
per<-as.vector(quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T))
breaks<-per[2:(length(per)-1)]
assign(paste0("result_",q),
smbinning.custom(df=X_train,y='isdefault',x=q,cuts = breaks))
}
result_consumption$ivtable
View(result_consumption$ivtable)
woetable_industry
woetable_industry$WOE
woetable_industry$IV
View(woetable_industry)
sum(woetable_industry$GOODS)
sum(woetable_industry$BADS)
730-31-157-330-139
View(result_consumption$ivtable)
View(result_consumption$ivtable)
View(result_CPI$ivtable)
smbinning
quantile(X_train[,q],probs=seq(0,1,0.3),na.rm=T)
2:(length(per)-1)
per[2:(length(per)-1)]
breaks<-per[2:(length(per)-1)]
breaks
q
View(result_finance_15$ivtable)
for (q in var_quant)
{
assign(paste0(q,"_woe"),c())
}
length(X_train)
nrow(X_train)
View(X_train)
rep(0,nrow(X_train))
woe_table_quant <- data.frame()
for (q in var_quant)
{
assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
}
View(woe_table_quant)
get(paste0(q,"_woe"))
cbind(woe_table_quant,get(paste0(q,"_woe")))
woe_table_quant$get(paste0(q,"_woe"))
woe_table_quant$get(paste0(q,"_woe")) <- rep(0,nrow(X_train))
woe_table_quant <- data.frame()
i <- 1
for (q in var_quant)
{
assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
if(i==1)
{
woe_table_quant <- as.data.frame(get(paste0(q,"_woe")))
}
else
{
woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
}
i <- i+1
# assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
# woe_table_quant$get(paste0(q,"_woe")) <- rep(0,nrow(X_train))
# woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
#
}
View(woe_table_quant)
woe_table_quant <- data.frame()
i <- 1
for (q in var_quant)
{
assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
if(i==1)
{
woe_table_quant <- as.data.frame(paste0(q,"_woe"))
}
else
{
woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
}
i <- i+1
# assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
# woe_table_quant$get(paste0(q,"_woe")) <- rep(0,nrow(X_train))
# woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
#
}
View(woe_table_quant)
woe_table_quant <- data.frame()
i <- 1
for (q in var_quant)
{
assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
if(i==1)
{
woe_table_quant <- as.data.frame(paste0(q,"_woe"))
}
else
{
woe_table_quant <- cbind(woe_table_quant,paste0(q,"_woe"))
}
i <- i+1
# assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
# woe_table_quant$get(paste0(q,"_woe")) <- rep(0,nrow(X_train))
# woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
#
}
View(woe_table_quant)
assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
colname <- get(paste0(q,"_woe"))
colname
get(paste0(q,"_woe"))
woe_table_quant$get(paste0(q,"_woe"))
woe_table_quant$(get(paste0(q,"_woe")))
woe_table_quant <- data.frame()
i <- 1
for (q in var_quant)
{
assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
woe_table_quant
if(i==1)
{
woe_table_quant <- as.data.frame(get(paste0(q,"_woe")))
}
else
{
woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
}
i <- i+1
# assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
# woe_table_quant$get(paste0(q,"_woe")) <- rep(0,nrow(X_train))
# woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
#
}
\
}
｝
）
)
}
j+l
1+1
2
2
3
4
5
View(woe_table_quant)
colnames(X_train)
colnames(woe_table_quant)[i]
i
woe_table_quant <- data.frame()
i <- 1
for (q in var_quant)
{
assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
woe_table_quant
if(i==1)
{
woe_table_quant <- as.data.frame(get(paste0(q,"_woe")))
}
else
{
woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
}
colnames(woe_table_quant)[i] <- paste0(q,"_woe")
i <- i+1
# assign(paste0(q,"_woe"),rep(0,nrow(X_train)))
# woe_table_quant$get(paste0(q,"_woe")) <- rep(0,nrow(X_train))
# woe_table_quant <- cbind(woe_table_quant,get(paste0(q,"_woe")))
#
}
View(woe_table_quant)
var_quant
q <- var_quant[1]
result <- get(paste0("result_",q))
result
result$cuts
length(colnames(var_quant))
length(colnames(woe_table_quant))
length(var_quant)
X_train[j,q]
j <- 1
X_train[j,q]
result$ivtable
result$cuts[1]
result$ivtable['WoE']
result$ivtable['WoE'][1]
result$ivtable['WoE'][[1]]
result$ivtable['WoE'][[1]][1]
result
length(result$cuts)
for (i in 1:length(var_quant))
{
q <- var_quant[i]
result <- get(paste0("result_",q))
#result$cuts
for (j in 1:nrow(X_train))
{
if(length(result$cuts)==2)
{
if(X_train[j,q]<=result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][1]
}
if((X_train[j,q]>result$cuts[1]) & (X_train[j,q]<=result$cuts[2]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][2]
}
if(X_train[j,q]>result$cuts[3])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][3]
}
#遇上woe值为inf，预留处理
if(woe_table_quant[j,i]==Inf)
{
}
}
if(length(result$cuts)==3)
{
if(X_train[j,q]<=result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][1]
}
if((X_train[j,q]>result$cuts[1]) & (X_train[j,q]<=result$cuts[2]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][2]
}
if((X_train[j,q]>result$cuts[2])&(X_train[j,q]<=result$cuts[3]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][3]
}
if(X_train[j,q]>result$cuts[3])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][4]
}
#遇上woe值为inf，预留处理
if(woe_table_quant[j,i]==Inf)
{
}
}
}
}
X_train[j,q]>result$cuts[3]
X_train[j,q]
result$cuts[3]
length(result$cuts)
length(result$cuts)==3
for (i in 1:length(var_quant))
{
q <- var_quant[i]
result <- get(paste0("result_",q))
#result$cuts
for (j in 1:nrow(X_train))
{
if(length(result$cuts)==2)
{
if(X_train[j,q]<=result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][1]
}
if((X_train[j,q]>result$cuts[1]) & (X_train[j,q]<=result$cuts[2]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][2]
}
if(X_train[j,q]>result$cuts[2])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][3]
}
#遇上woe值为inf，预留处理
if(woe_table_quant[j,i]==Inf)
{
}
}
if(length(result$cuts)==3)
{
if(X_train[j,q]<=result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][1]
}
if((X_train[j,q]>result$cuts[1]) & (X_train[j,q]<=result$cuts[2]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][2]
}
if((X_train[j,q]>result$cuts[2])&(X_train[j,q]<=result$cuts[3]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][3]
}
if(X_train[j,q]>result$cuts[3])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][4]
}
#遇上woe值为inf，预留处理
if(woe_table_quant[j,i]==Inf)
{
}
}
}
}
View(woe_table_quant)
result_belta_yj$ivtable
result_belta_yj$cuts
View(woetable_bond_type_wind_1)
View(woetable_industry)
woe_table_factor <- X_train(,c('is_default','listed_woe','bond_type_wind_1_woe','company_type_woe','exchange_woe','industry_woe','province_woe'))
woe_table_factor <- X_train[,c('is_default','listed_woe','bond_type_wind_1_woe','company_type_woe','exchange_woe','industry_woe','province_woe')]
for (i in 1:length(var_quant))
{
q <- var_quant[i]
result <- get(paste0("result_",q))
#result$cuts
for (j in 1:nrow(X_train))
{
if(length(result$cuts)==1)
{
if(X_train[j,q]<=result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][1]
}
if(X_train[j,q]>result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][2]
}
#遇上woe值为inf，预留处理
if(woe_table_quant[j,i]==Inf)
{
woe_table_quant[j,i]=10
}
}
if(length(result$cuts)==2)
{
if(X_train[j,q]<=result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][1]
}
if((X_train[j,q]>result$cuts[1]) & (X_train[j,q]<=result$cuts[2]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][2]
}
if(X_train[j,q]>result$cuts[2])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][3]
}
#遇上woe值为inf，预留处理
if(woe_table_quant[j,i]==Inf)
{
woe_table_quant[j,i]=10
}
}
if(length(result$cuts)==3)
{
if(X_train[j,q]<=result$cuts[1])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][1]
}
if((X_train[j,q]>result$cuts[1]) & (X_train[j,q]<=result$cuts[2]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][2]
}
if((X_train[j,q]>result$cuts[2])&(X_train[j,q]<=result$cuts[3]))
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][3]
}
if(X_train[j,q]>result$cuts[3])
{
woe_table_quant[j,i] <- result$ivtable['WoE'][[1]][4]
}
#遇上woe值为inf，预留处理
if(woe_table_quant[j,i]==Inf)
{
woe_table_quant[j,i]=10
}
}
}
}
View(woe_table_quant)
model_data <- cbind(woe_table_factor,woe_table_quant)
logr <- glm(is_default~.,data=model_data,family = binomial)
predicted_ori <- predict(logr,type = 'response')
summary(logr)
