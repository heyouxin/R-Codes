{
    "collab_server" : "",
    "contents" : "rm(list=ls())\n\n\nlibrary(xlsx)\nraw_data <- read.xlsx(\"C:/Users/heyouxin/Desktop/2013_2003城市数据整理v5.xlsx\",1,encoding = \"UTF-8\",stringsAsFactors=F)\n\n\n\ndata <-raw_data\ndata2 <- data[,10:99]\ndata <- data[,1:9]\ndata <- data[-285,]\ndata2 <- data2[-285,]\n\n  View(data)\n\n \n\nnames(data) <-c(\"city_name\",\"city\",\"year\",\"SO2\",\"popu\",\"p_gdp\",\"hos\",\"bed\",\"doc\")\n\nfor (i in 1:10) \n{\n  temp_data <- data2[,(9*(i-1)+1):(9*i)]\n  names(temp_data) <- c(\"city_name\",\"city\",\"year\",\"SO2\",\"popu\",\"p_gdp\",\"hos\",\"bed\",\"doc\")\n  data <- rbind(data,temp_data)\n  \n}\nwarnings()\n\n\n\n\n\nfor (y in 1:11) \n{\n  data[(284*(y-1)+1):(284*y),3] <- (2014-y)\n  \n}\n\n\n\nwrite.xlsx(data,\"C:/Users/heyouxin/Desktop/2013_2003城市数据.xlsx\")\n\n\ndata3 <- read.xlsx(\"C:/Users/heyouxin/Desktop/2013_2003城市数据.xlsx\",1,encoding = \"UTF-8\",stringsAsFactors=F)\n\nView(data3)\n\nif(grepl(\"*市\",data3$city_name))\n{\n  city_name2 <- gsub(\"市\",\"\",data3$city_name)\n}\n\ndata4 <- cbind(data3,city_name2,stringsAsFactors=F)\n\n\n  data4$city_name2 <- gsub(\"([N ])\", \"\",data4$city_name2 )\n\nwhich(is.na(city_name2))\n\nView(data4)\n\ntypeof(patent_data$city)\n\ntypeof(data4$year)\n\n\npatent_data <- read.csv(\"C:/Users/heyouxin/Desktop/patent_city_year.csv\",stringsAsFactors = F)\nif(grepl(\"*市\",patent_data$city))\n{\n  city <- gsub(\"市\",\"\",patent_data$city)\n}\n\npatent_data$city <- gsub(\"([N ])\", \"\",patent_data$city )\n\nView(patent_data)\ntypeof(patent_data$appliyear)\ntypeof(patent_data$city)\ntypeof(patent_data$patent_num)\npatent_data$city <- as.character(patent_data$city)\ntypeof(data4$year)\ntypeof(data4$city_name2)\ntypeof(patent_data$patent_num)\nwhich(patent_data$city==data4$city_name2)==T\n\ndata4$year <- as.integer(data4$year)\nlibrary(dplyr)\ndata5 <- left_join(data4,patent_data,c(\"city_name2\"=\"city\",\"year\"=\"appliyear\"))\nView(data5)\n\nsubset(data4,city_name2=\"北京\")\n\n\nwhich(data4$city_name2==\"  石家庄\")\n\nView(data4)\nwhich(data4$city_name2==\"普洱\")\n\nwhich(data4$city_name2==\"Simao\")\n\ndata4[537,]\n\ndata4$city_name2[537] <- \"思茅\"\n\n\n\n\nlibrary(sqldf)\nsql <- sqldf(c(\"select * from data4 left join patent_data  on (data4.city_name2=patent_data.city and data4.year=patent_data.appliyear) group by data4.city_name2,data4.year\"))\n\n\n\nsql2 <- sql[,-c(12:13)]\n#View(sql2)\nsql2$city_name <- sql2$city_name2\nsql2 <- sql2[,-10]\nif(is.na(sql2$patent_num))\n{\n  sql2[which(is.na(sql2$patent_num)),10]=0\n  sql2$patent_num=0\n  \n}\nView(sql2)\n\nwhich(sql2[])\n\n\nwrite.csv(sql2,\"C:/Users/heyouxin/Desktop/2013_2003_final_2.csv\",row.names = F)\n\ndata_final <- read.csv(\"C:/Users/heyouxin/Desktop/2013_2003_final_2.csv\")\nView(data_final)\n\np_patent <- data_final$patent_num/data_final$popu\np_doc <- data_final$doc/data_final$popu\n\ndata_final2 <-cbind(data_final2,p_doc) \n\ndata_final2$city <- as.integer(data_final2$city)\nfor (i in 1:283) \n{\n  data_final2[(11*(i-1)+1):(11*i),2] <- i\n  \n}\nView(data_final2)\nwrite.csv(data_final2,\"C:/Users/heyouxin/Desktop/2013_2003_final_3.csv\",row.names = F)\n\nlibrary(xlsx)\n\ndata_fix <- read.xlsx(\"C:/Users/heyouxin/Desktop/2013_2003_final_3.xlsx\",1,stringsAsFactors = F,encoding = \"UTF-8\")\nView(data_fix)\ndata_fix2 <- data_fix\nlibrary(sqldf)\n\n\ndf <- sqldf(c(\"select * from data_fix2 left join patent_data on (data_fix2.city_name=patent_data.city and data_fix2.year=patent_data.appliyear) group by data_fix2.city_name,data_fix2.year\"))\n\nView(df)\n\ndf <- df[,-10]\ndf$patent_num.1\ndf[which(is.na(df$patent_num.1)),12]=0\ndf$p_patent <- df$patent_num.1/df$popu\n\ndf$city <- as.integer(df$city)\nfor (i in 1:283) \n{\n  df[(11*(i-1)+1):(11*i),2] <- i\n  \n}\ndf[273,6] <- 24853\n\nwrite.csv(df,\"C:/Users/heyouxin/Desktop/2013_2003_final_4.csv\",row.names = F)\n\n\nlibrary(xlsx)\n\ndata_fix <- read.xlsx(\"C:/Users/heyouxin/Desktop/2013_2003_final_5.xlsx\",1,stringsAsFactors = F,encoding = \"UTF-8\")\nView(data_fix)\n\ndata_fix[which(is.na(df$patent_num.1)),7]\ndata_fix$hos <- as.numeric(data_fix$hos)\n\np_hos <- data_fix$hos/data_fix$popu\ntypeof(p_hos)\ndata_fix <- cbind(data_fix,p_hos)\nwrite.csv(data_fix,\"C:/Users/heyouxin/Desktop/2013_2003_final_5.csv\",row.names = F)\nwarnings()\nwhich(is.na(data_fix$hos))\n\ndf <- read.csv(\"C:/Users/heyouxin/Desktop/2013_2003_final_5.csv\")\nView(df)\nView(df[which(df$p_doc<5),])\n\n",
    "created" : 1508839208763.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1579976227",
    "id" : "7199003E",
    "lastKnownWriteTime" : 1514876525,
    "last_content_update" : 1514876525,
    "path" : "~/R Codes/lecture_get/data_opera.R",
    "project_path" : "data_opera.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}