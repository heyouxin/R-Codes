#login_password$sendKeysToElement(list("123456"))
login_account <- remDr$findElement(using = "css", "[name = 'UserName']")
login_account$sendKeysToElement(list("15320161152320"))
login_password <- remDr$findElement(using = "css", "[name = 'Password']")
login_password$sendKeysToElement(list("wskdcqqq"))
login <- remDr$findElement(using = 'css selector', "#default-main > div.default-content.logon-content > div > div > div.save-operation > input")
login$clickElement()
Sys.sleep(3)
webElems <- remDr$findElements(using = 'css selector', "td:nth-child(14)")
Action <- unlist(lapply(webElems, function(x){x$getElementText()}))
while(!any(Action[]=="Reserve this seminar"))
{
#Sys.sleep(1)
remDr$refresh()
webElems <- remDr$findElements(using = 'css selector', "td:nth-child(14)")
Action <- unlist(lapply(webElems, function(x){x$getElementText()}))
}
n <- length(Action)
for (i in 1:n)
{
if(Action[i]=="Reserve this seminar")
{
location <- paste0("#ctl00_MainContent_GridView1_ctl0",i+1,"_btnreceive")
make_reservation <- remDr$findElement(using = 'css selector', location)
make_reservation$clickElement()
Sys.sleep(3)
}
}
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
for (times in 1:9)
{
remDr$open()
remDr$navigate("http://event.soe.xmu.edu.cn/LectureOrder.aspx")
#login_account <- remDr$findElement(using = "css", "[name = 'UserName']")
#login_account$sendKeysToElement(list("15320161152321"))
#login_password <- remDr$findElement(using = "css", "[name = 'Password']")
#login_password$sendKeysToElement(list("123456"))
login_account <- remDr$findElement(using = "css", "[name = 'UserName']")
login_account$sendKeysToElement(list("15320161152320"))
login_password <- remDr$findElement(using = "css", "[name = 'Password']")
login_password$sendKeysToElement(list("wskdcqqq"))
login <- remDr$findElement(using = 'css selector', "#default-main > div.default-content.logon-content > div > div > div.save-operation > input")
login$clickElement()
Sys.sleep(3)
webElems <- remDr$findElements(using = 'css selector', "td:nth-child(14)")
Action <- unlist(lapply(webElems, function(x){x$getElementText()}))
while(!any(Action[]=="Reserve this seminar"))
{
#Sys.sleep(1)
remDr$refresh()
webElems <- remDr$findElements(using = 'css selector', "td:nth-child(14)")
Action <- unlist(lapply(webElems, function(x){x$getElementText()}))
}
n <- length(Action)
for (i in 1:n)
{
if(Action[i]=="Reserve this seminar")
{
location <- paste0("#ctl00_MainContent_GridView1_ctl0",i+1,"_btnreceive")
make_reservation <- remDr$findElement(using = 'css selector', location)
make_reservation$clickElement()
Sys.sleep(3)
}
}
}
w.start()
library(WindR)
w.start()
install.packages("quantmod")
chartSeries(ts,TA=c(addVo(),addBBands(),addMACD()),up.col="red",dn.col="#00ffff",name=code)
require(WindR)
require(quantmod)
#user should start WindR firstly.
w.start(showmenu=FALSE);
code<-"600004.SH"
wsd_data<- w.wsd(code,"open,high,low,close,volume",Sys.time()-24*3600*100,Sys.time()-24*3600)
if(wsd_data$ErrorCode[[1]]!=0)
{
error("w.wsd error")
}
data <-wsd_data$Data
ts <- xts(data[,-1],data[,1])
chartSeries(ts,TA=c(addVo(),addBBands(),addMACD()),up.col="red",dn.col="#00ffff",name=code)
require(WindR)
w.start(showmenu=FALSE);
code<-"600004.SH"
wsi_data<- w.wsi(code,"open,high,low,close",Sys.time()-24*3600*8,Sys.time(),options='BarSize=10')
if(wsi_data$ErrorCode[[1]]!=0)
{
error("w.wsd error")
}
data<-wsi_data$Data;
getnamebycode<-function(code)
{
data<-w.wss(code,"sec_name")#通过WSS获取股票名称
if(data$ErrorCode==0)
return (as.character(data$Data$SEC_NAME[[1]]))
else
return (NULL)
}
require(WindR)
w.start(showmenu=FALSE);
code<-"000001.SH";#IF1306.CFE";#600004.SH"
begintime<-format(Sys.time(),"%Y%m%d 09:30:00");
endtime  <-format(Sys.time(),"%Y%m%d 15:00:00");
wst_data<- w.wst(code,"open,high,low,last",begintime,endtime)
if(wst_data$ErrorCode[[1]]!=0)
{
error("w.wsd error")
}
data<-wst_data$Data;
getnamebycode<-function(code)
{
data<-w.wss(code,"sec_name")#通过WSS获取股票名称
if(data$ErrorCode==0)
return (as.character(data$Data$SEC_NAME[[1]]))
else
return (NULL)
}
require(WindR)
w.start(showmenu=FALSE);
code<-"000001.SH";#IF1306.CFE";#600004.SH"
begintime<-format(Sys.time(),"%Y%m%d 09:30:00");
endtime  <-format(Sys.time(),"%Y%m%d 15:00:00");
wst_data<- w.wst(code,"open,high,low,last",begintime,endtime)
if(wst_data$ErrorCode[[1]]!=0)
{
error("w.wsd error")
}
data<-wst_data$Data;
getnamebycode<-function(code)
{
data<-w.wss(code,"sec_name")#通过WSS获取股票名称
if(data$ErrorCode==0)
return (as.character(data$Data$SEC_NAME[[1]]))
else
return (NULL)
}
require(WindR)
w.start(showmenu=FALSE);
code<-"000001.SH";#IF1306.CFE";#600004.SH"
begintime<-format(Sys.time(),"%Y%m%d 09:30:00");
endtime  <-format(Sys.time(),"%Y%m%d 15:00:00");
wst_data<- w.wst(code,"open,high,low,last",begintime,endtime)
wst_data
wst_data<- w.wst(code,"open,high,low,last",begintime,endtime)
wst_data
load("C:/Users/heyouxin/Desktop/da_all_m_a.RData")
library(lubridate)
library(data.table)
library(dplyr)
library(zoo)
library(sandwich)
library(lmtest)
sink(file="C:/Users/Ding/Desktop/result.txt",append=T)
sink()
rm(list=ls())
#################################
#### Input the Monthly Stock Data
da_all_m <- NULL # daily price for all securities
# There something wrong for "fread" to read this data.
# Everything is fine when using "read.csv".
for (i in 2007:2016) {
path <- paste0("F:/我的论文/第三篇/RData/da_m/",i,".csv")
da_all_m <- rbind(da_all_m,read.csv(path,header=T))
}
da_all_m <- da_all_m[,-ncol(da_all_m)]
save(da_all_m,file="C:/Users/Ding/Desktop/da_all_m.RData")
#################################
load("D:/厦门大学研究生/量化投资（赵华）/作业/HW3/RData/da_all_m.RData")
da_all_m <- as.data.table(na.omit(da_all_m[,c(3,9,10,24,29,37,43)]))
names(da_all_m) <- c("SecCode","TDate","clpr","trdshr","ret","rf","PB")
# only include A stock
da_all_m <- da_all_m[(SecCode>=600000 & SecCode<900000) | SecCode<200000,]
da_all_m[,`:=`(ret_e = ret-rf,
size = clpr*trdshr,
BM = 1/PB,
TDate = ymd(TDate))]
da_all_m[,`:=`(y = year(TDate),
m = month(TDate))]
da_all_m[,ym := ymd(paste0(y,"-",m,"-",1))]
save(da_all_m,file="C:/Users/Ding/Desktop/da_all_m_a.RData")
# a denotes the adjusted version of the previous da_all_m.RData
#################################
#### Calculate FFC4F
load("D:/厦门大学研究生/量化投资（赵华）/作业/HW3/RData/da_all_m_a.RData")
da_all_m[,group_size:=ifelse(size>median(size),"b","s"),by=ym]
da_all_m[BM<=quantile(BM,0.3),group_BM := "l",by=.(ym,group_size)]
da_all_m[BM>quantile(BM,0.3) & BM<=quantile(BM,0.7),group_BM := "m",by=.(ym,group_size)]
da_all_m[BM>quantile(BM,0.7),group_BM := "h",by=.(ym,group_size)]
# Method 1 # filter stocks having more than 13 observations
selectedcode <- da_all_m[,.N,by=SecCode][N>=13,SecCode]
da_all_m <- da_all_m[SecCode %in% selectedcode,]
# Method 2 # use dplyr to slove the same problem
da_all_m <- da_all_m %>% group_by(SecCode) %>% filter(n()>=13)
da_all_m <- as.data.table(da_all_m)
da_all_m[,`:=`(ret_0_12=rollsum(ret,13,align="right",fill=NA),
ret_0_1=rollsum(ret,2,align="right",fill=NA)),by=SecCode]
da_all_m[,ret_mom := ret_0_12-ret_0_1]
da_all_m[ret_mom<=quantile(ret_mom,0.3,na.rm=T),group_mom := "d",by=ym]
da_all_m[ret_mom>quantile(ret_mom,0.3,na.rm=T) & ret_mom<=quantile(ret_mom,0.7,na.rm=T),
group_mom := "m",by=ym]
da_all_m[ret_mom>quantile(ret_mom,0.7,na.rm=T),group_mom := "u",by=ym]
FFC4F <- da_all_m[,.(ym=sort(unique(ym)))]
FFC4F$smb <- da_all_m[group_size=="s",weighted.mean(ret,size),keyby=ym][[2]]-
da_all_m[group_size=="b",weighted.mean(ret,size),keyby=ym][[2]]
FFC4F$hml <- (da_all_m[group_size=="b" & group_BM=="h",weighted.mean(ret,size),keyby=ym][[2]]-
da_all_m[group_size=="b" & group_BM=="l",weighted.mean(ret,size),keyby=ym][[2]])/2+
((da_all_m[group_size=="s" & group_BM=="h",weighted.mean(ret,size),keyby=ym][[2]]-
da_all_m[group_size=="s" & group_BM=="l",weighted.mean(ret,size),keyby=ym][[2]]))/2
FFC4F$umd <- c(rep(NA,12),da_all_m[group_mom=="u",mean(ret),keyby=ym][[2]]-
da_all_m[group_mom=="d",mean(ret),keyby=ym][[2]])
FFC4F$mkt <- da_all_m[,weighted.mean(ret_e,size),keyby=ym][,2]
save(FFC4F,file="C:/Users/Ding/Desktop/FFC4F.RData")
#################################
#### 25 Fama-French Portfolios
load("D:/厦门大学研究生/量化投资（赵华）/作业/HW3/RData/da_all_m_a.RData")
load("D:/厦门大学研究生/量化投资（赵华）/作业/HW3/RData/FFC4F.RData")
da_all_m[size<=quantile(size,0.2),group_size := 1,by=ym]
da_all_m[size>quantile(size,0.2) & size<=quantile(size,0.4),group_size := 2,by=ym]
da_all_m[size>quantile(size,0.4) & size<=quantile(size,0.6),group_size := 3,by=ym]
da_all_m[size>quantile(size,0.6) & size<=quantile(size,0.8),group_size := 4,by=ym]
da_all_m[size>quantile(size,0.8),group_size := 5,by=ym]
da_all_m[BM<=quantile(BM,0.2),group_BM := 1,by=ym]
da_all_m[BM>quantile(BM,0.2) & BM<=quantile(BM,0.4),group_BM := 2,by=ym]
da_all_m[BM>quantile(BM,0.4) & BM<=quantile(BM,0.6),group_BM := 3,by=ym]
da_all_m[BM>quantile(BM,0.6) & BM<=quantile(BM,0.8),group_BM := 4,by=ym]
da_all_m[BM>quantile(BM,0.8),group_BM := 5,by=ym]
ret_p <- array(NA,c(5,5,nrow(FFC4F)))
now()
for (i in 1:5) {
for (j in 1:5) {
for (k in 1:nrow(FFC4F)) {
ret_p[i,j,k] <- da_all_m[group_size==i & group_BM==j & ym==FFC4F[k,ym],weighted.mean(ret_e,size)]
}
}
}
now()
model_4_er <- matrix(NA,nrow=5,ncol=5)
model_4_alpha <- matrix(NA,nrow=5,ncol=5)
model_4_alpha_t <- matrix(NA,nrow=5,ncol=5) # Newey-West t statistics
model_4_mkt <- matrix(NA,nrow=5,ncol=5)
model_4_smb <- matrix(NA,nrow=5,ncol=5)
model_4_hml <- matrix(NA,nrow=5,ncol=5)
model_4_umd <- matrix(NA,nrow=5,ncol=5)
model_4_r2 <- matrix(NA,nrow=5,ncol=5)
model_4_adj_r2 <- matrix(NA,nrow=5,ncol=5)
for (i in 1:5) {
for (j in 1:5) {
model_4_er[i,j] <- mean(ret_p[i,j,],na.rm=T)
model <- lm(ret_p[i,j,]~FFC4F[,mkt]+FFC4F[,smb]+FFC4F[,hml]+FFC4F[,umd])
model_4_alpha[i,j] <- summary(model)$coefficients[1,1]
model_4_alpha_t[i,j] <- coeftest(model,vcov = NeweyWest(model))[1,3]
model_4_mkt[i,j] <- summary(model)$coefficients[2,1]
model_4_smb[i,j] <- summary(model)$coefficients[3,1]
model_4_hml[i,j] <- summary(model)$coefficients[4,1]
model_4_umd[i,j] <- summary(model)$coefficients[5,1]
model_4_r2[i,j] <- summary(model)$r.squared
model_4_adj_r2[i,j] <- summary(model)$adj.r.squared
}
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://xsswdt.xmu.edu.cn/index")
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://xsswdt.xmu.edu.cn/index")
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://xsswdt.xmu.edu.cn/index")
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://xsswdt.xmu.edu.cn/index")
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
#remDr$navigate("http://xsswdt.xmu.edu.cn/index")
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
#remDr$navigate("http://xsswdt.xmu.edu.cn/index")
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://ids.xmu.edu.cn/authserver/login?service=http://xsswdt.xmu.edu.cn/login/login/idsLogin")
login_account <- remDr$findElement(using = "css", "#username")
login_account$sendKeysToElement(list("15520170155207"))
login_password <- remDr$findElement(using = "css", "#password")
login_password$sendKeysToElement(list("180929"))
login <- remDr$findElement(using = 'css selector', ".auth_login_btn")
login$clickElement()
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://ids.xmu.edu.cn/authserver/login?service=http://xsswdt.xmu.edu.cn/login/login/idsLogin")
login_account <- remDr$findElement(using = "css", "#username")
login_account$sendKeysToElement(list("15520170155207"))
login_password <- remDr$findElement(using = "css", "#password")
login_password$sendKeysToElement(list("180929"))
login <- remDr$findElement(using = 'css selector', ".auth_login_btn")
login$clickElement()
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
Sys.sleep(5)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://ids.xmu.edu.cn/authserver/login?service=http://xsswdt.xmu.edu.cn/login/login/idsLogin")
login_account <- remDr$findElement(using = "css", "#username")
login_account$sendKeysToElement(list("15520170155207"))
login_password <- remDr$findElement(using = "css", "#password")
login_password$sendKeysToElement(list("180929"))
login <- remDr$findElement(using = 'css selector', ".auth_login_btn")
login$clickElement()
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
Sys.sleep(3)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://ids.xmu.edu.cn/authserver/login?service=http://xsswdt.xmu.edu.cn/login/login/idsLogin")
login_account <- remDr$findElement(using = "css", "#username")
login_account$sendKeysToElement(list("15520170155207"))
login_password <- remDr$findElement(using = "css", "#password")
login_password$sendKeysToElement(list("180929"))
login <- remDr$findElement(using = 'css selector', ".auth_login_btn")
login$clickElement()
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
Sys.sleep(3)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://ids.xmu.edu.cn/authserver/login?service=http://xsswdt.xmu.edu.cn/login/login/idsLogin")
login_account <- remDr$findElement(using = "css", "#username")
login_account$sendKeysToElement(list("15520170155207"))
login_password <- remDr$findElement(using = "css", "#password")
login_password$sendKeysToElement(list("180929"))
login <- remDr$findElement(using = 'css selector', ".auth_login_btn")
login$clickElement()
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
Sys.sleep(3)
}
rm(list=ls())
library(httr)
library(rvest)
library(RSelenium)
remDr <- remoteDriver(remoteServerAddr = "localhost"
, port = 4444
, browserName = "chrome"
)
remDr$open()
remDr$navigate("http://ids.xmu.edu.cn/authserver/login?service=http://xsswdt.xmu.edu.cn/login/login/idsLogin")
login_account <- remDr$findElement(using = "css", "#username")
login_account$sendKeysToElement(list("15520170155207"))
login_password <- remDr$findElement(using = "css", "#password")
login_password$sendKeysToElement(list("180929"))
login <- remDr$findElement(using = 'css selector', ".auth_login_btn")
login$clickElement()
remDr$navigate("http://gongyu.xmu.edu.cn/index.php/Student/Freshman/index")
while(1)
{
remDr$refresh()
Sys.sleep(1)
}
