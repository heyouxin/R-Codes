{
    "collab_server" : "",
    "contents" : "##reference:20140507-国泰君安-数量化专题之四十二：寻找牛、熊股基本特征_基于财务、估值角度”\n##按财务指标择股\ngetBasicFinance <- function(A_stock)\n{\n \n  ##2017年第一、二季度ROE均位于前50%  \n  roe_2017_1 <- w.wsd(A_stock,\"roe\",\"2017-01-01\",\"2017-3-31\",\"Period=Q\")$Data\n  roe_2017_1 <- na.omit(roe_2017_1)\n  roe_2017_1_50 <- roe_2017_1[roe_2017_1$ROE>quantile(na.omit(roe_2017_1$ROE),0.5),]\n  \n  roe_2017_2 <- w.wsd(A_stock,\"roe\",\"2017-04-01\",\"2017-6-30\",\"Period=Q\")$Data\n  roe_2017_2 <- na.omit(roe_2017_2)\n  roe_2017_2_50 <- roe_2017_2[roe_2017_2$ROE>quantile(na.omit(roe_2017_2$ROE),0.5),]\n  \n  roe_50 <- merge(roe_2017_1_50,roe_2017_2_50,by=\"CODE\")\n \n  \n  ##2017年第一、二季度pe均位于后50%且PE大于0 \n  pe_2017_1 <- w.wsd(A_stock,\"pe_ttm\",\"2017-01-01\",\"2017-3-31\",\"Period=Q\")$Data\n  pe_2017_1 <- na.omit(pe_2017_1)\n  pe_2017_1_50 <- pe_2017_1[(pe_2017_1$PE_TTM<quantile(pe_2017_1$PE_TTM,0.5))&(pe_2017_1$PE_TTM>0),]\n  \n  \n  pe_2017_2 <- w.wsd(A_stock,\"pe_ttm\",\"2017-04-01\",\"2017-6-30\",\"Period=Q\")$Data\n  pe_2017_2 <- na.omit(pe_2017_2)\n  pe_2017_2_50 <- pe_2017_2[(pe_2017_2$PE_TTM<quantile(pe_2017_2$PE_TTM,0.5))&(pe_2017_2$PE_TTM>0),]\n  \n  pe_50 <- merge(pe_2017_1_50,pe_2017_2_50,by=\"CODE\")\n  \n  roe_pe <- merge(roe_50,pe_50,by=\"CODE\")\n  \n  ##2017年第一、二季度净利润增长率均位于前50%  \n  yoyprofit_2017_1 <- w.wsd(A_stock,\"yoyprofit\",\"2017-01-01\",\"2017-3-31\",\"Period=Q\")$Data\n  yoyprofit_2017_1 <- na.omit(yoyprofit_2017_1)\n  yoyprofit_2017_1_50 <- yoyprofit_2017_1[yoyprofit_2017_1$YOYPROFIT>quantile(yoyprofit_2017_1$YOYPROFIT,0.5),]\n\n  yoyprofit_2017_2 <- w.wsd(A_stock,\"yoyprofit\",\"2017-04-01\",\"2017-6-30\",\"Period=Q\")$Data\n  yoyprofit_2017_2 <- na.omit(yoyprofit_2017_2)\n  yoyprofit_2017_2_50 <- yoyprofit_2017_2[yoyprofit_2017_2$YOYPROFIT>quantile(yoyprofit_2017_2$YOYPROFIT,0.5),]\n  \n  yoyprofit_50 <- merge(yoyprofit_2017_1_50,yoyprofit_2017_2_50,by=\"CODE\")\n  #View(yoyprofit_75) \n  roe_pe_yoyprofit <- merge(roe_pe,yoyprofit_50,by=\"CODE\")\n  #View(roe_pe)\n  stockID <- roe_pe_yoyprofit[,1]  \n  \n  return (stockID)\n  \n  \n}\n\n\n\n##获得MACD,MDA,price的数据\ngetHQ <- function(stockID,date_from,date_to)\n{\n  w_wsd_data<-w.wsd(stockID,\"MACD\",date_from,date_to,\"MACD_L=26;MACD_S=12;MACD_N=9;MACD_IO=3\")\n  MACD_data <- as.data.frame(w_wsd_data$Data)\n  w_wsd_data<-w.wsd(stockID,\"MACD\",date_from,date_to,\"MACD_L=26;MACD_S=12;MACD_N=9;MACD_IO=2;PriceAdj=F\")\n  DEA_data <- as.data.frame(w_wsd_data$Data)\n  w_wsd_data<-w.wsd(stockID,\"close\",date_from,date_to,\"PriceAdj=F\")\n  close_price <- as.data.frame(w_wsd_data$Data)\n  HQ <- list(MACD_data,DEA_data,close_price)\n  return (HQ)\n}\n\n##获得30分钟行情的分钟数据\ngetMinHQ <- function(stock_long,min=30)\n{\n  #date_from <- paste0(date_from,\" 09:00:00\")\n  #date_to <- paste0(date_to,\" 15:00:00\")\n  #w_wsi_data<-w.wsi(stock_long,close,date_from,date_to,\"BarSize=30;PriceAdj=F\")\n  w_wsi_data<-w.wsi(stock_long,\"close\",\"2017-12-08 09:00:00\",\"2017-12-13 15:00:00\",\"BarSize=30\")\n  MinHQ_1 <- as.data.frame(w_wsi_data$Data)\n \n  w_wsi_data<-w.wsi(stock_long,\"close\",\"2017-12-14 09:00:00\",\"2017-12-17 16:32:52\",\"BarSize=30\")\n  MinHQ_2 <- as.data.frame(w_wsi_data$Data)\n  MinHQ <- rbind(MinHQ_1,MinHQ_2)\n  return(MinHQ)\n \n}\n\n##part1:\n##reference：国泰君安数量化专题之二十九：发现价格走势规律之基于MACD分段研究\n##基于MACD的DEA指标判断是上涨阶段。需满足以下条件：\n##1.当前交易日的DEA>0的点 A\n##2.向左遍历得到一个DEA<0的点B\n##3.在AB区间内 max_price(B_A)=price(A)\n##4.从B点向左遍历，得到一个DEA>0的点C，且max_price(C_B)=price(C)\n##5.点B定义为可疑的底部拐点\n##6.若点B满足min_price(C_A)=price(B)\n##7.点B为底部拐点\n\n##part2:\n##reference:国泰君安数量化专题之八十：基于MACD的价格分段研究3.0\n##快速突破的情形\nupByDEA <- function(DEA_data,price_close)\n{\n  t <- nrow(DEA_data)\n  stock_DEA=c()\n  stock_DEA1=c()\n  stock_DEA2=c()\n  for (c in 2:length(names(DEA_data))) \n  {\n    if(DEA_data[t,c]>0)\n    {\n      for(r in (t-1):2)\n      {\n        if(DEA_data[r,c]<0 & price_close[t,c]==max(price_close[r:t,c]))\n        {\n          for (r_L in (r-1):1) \n          {\n            if(DEA_data[r_L,c]>0 & price_close[r_L,c]==max(price_close[r_L:r,c]) & price_close[r,c]==min(price_close[r_L:t,c]))\n            #if(DEA_data[r_L,c] & price_close[r_L,c]==max(price_close[r_L:r,c]) & price_close[r,c]==min(price_close[r_L:t,c]))\n            {\n              stock_DEA1 <- c(stock_DEA1,names(DEA_data)[c])\n              #r的位置为底部点 返回满足条件的股票代码\n              #print(names(DEA_data)[c])\n            }\n          }\n        }\n      }\n    }\n    ##快速突破\n    else\n    {\n      for(r in (t-1):2)\n      {\n        if(DEA_data[r,c]<0 & price_close[t,c]==max(price_close[r:t,c]))\n        {\n          for (r_L in (r-1):1) \n          {\n            if(DEA_data[r_L,c]>0 & price_close[r_L,c]==max(price_close[r_L:r,c]) & price_close[r,c]==min(price_close[r_L:t,c]) & price_close[t,c]==max(price_close[r_L:t,c]))\n            {\n              stock_DEA2 <- c(stock_DEA2,names(DEA_data)[c])\n            }\n          }\n        }\n      }\n    }\n     \n    \n  }\n  stock_DEA1 <- unique(stock_DEA1)\n  stock_DEA2 <- unique(stock_DEA2)\n  stock_DEA <- unique(union(stock_DEA1,stock_DEA2))\n  return(stock_DEA)\n  #return(list(stock_DEA1,stock_DEA2))\n}\n\n\n\n##判断下跌的情况\ndownByDEA <- function(DEA_data,price_close)\n{\n  t <- nrow(DEA_data)\n  stock_DEA=c()\n  stock_DEA1=c()\n  stock_DEA2=c()\n  for (c in 2:length(names(DEA_data))) \n  {\n    #c <- 2\n    if(DEA_data[t,c]<0)\n    {\n      for(r in (t-1):2)\n      {\n        if(DEA_data[r,c]>0 & price_close[t,c]==min(price_close[r:t,c]))\n        {\n          for (r_L in (r-1):1) \n          {\n            if(DEA_data[r_L,c]<0 & price_close[r_L,c]==min(price_close[r_L:r,c]) & price_close[r,c]==max(price_close[r_L:t,c]))\n            #if(DEA_data[r_L,c] & price_close[r_L,c]==min(price_close[r_L:r,c]) & price_close[r,c]==max(price_close[r_L:t,c]))\n            { \n              stock_DEA1 <- c(stock_DEA1,names(DEA_data)[c])\n            }\n          }\n        }\n      }\n    }\n    \n    ##快速突破\n    else\n    {\n      for(r in (t-1):2)\n      {\n        if(DEA_data[r,c]>0 & price_close[t,c]==min(price_close[r:t,c]))\n        {\n          for (r_L in (r-1):1) \n          {\n            if(DEA_data[r_L,c]<0 & price_close[r_L,c]==min(price_close[r_L:r,c]) & price_close[r,c]==max(price_close[r_L:t,c]) & price_close[t,c]==min(price_close[r_L:t,c]))\n            {\n              stock_DEA2 <- c(stock_DEA2,names(DEA_data)[c])\n            }\n          }\n        }\n      }\n    }\n  \n  }\n  stock_DEA1 <- unique(stock_DEA1)\n  stock_DEA2 <- unique(stock_DEA2)\n  stock_DEA <- unique(union(stock_DEA1,stock_DEA2))\n  return(stock_DEA)\n  #return(list(stock_DEA1,stock_DEA2))\n}\n\n\n\n##用30分钟数据判断上涨的行情受到阻止、突破\n##reference:国泰君安数量化专题之八十三:基于MACD价格分段的阻力与支撑研究\n##这只是一种下跌的情况。不是充分条件！！！\ndownByMinHQ <- function(MinHQ)\n{\n  stock_sell <- c()\n  for (n in 2:length(names(MinHQ))) \n  {\n    d <- nrow(MinHQ)\n    for (c in (d-1):3) \n    {\n      if(MinHQ[c,n]==max(MinHQ[c:d,n]) & MinHQ[d,n]==min(MinHQ[c:d,n]))\n      { \n        for (b in (c-1):2) \n        {\n          if(MinHQ[b,n]==min(MinHQ[b:c,n]) & MinHQ[c,n]==max(MinHQ[b:c,n]) & MinHQ[b,n]>MinHQ[d,n])\n          {\n            for (a in (b-1):1) \n            {\n              if(MinHQ[a,n]==max(MinHQ[1:d,n]) & MinHQ[a,n]>MinHQ[c,n])\n              {\n                stock_sell <- c(stock_sell,names(MinHQ)[n])\n                stock_sell <- unique(stock_sell)\n                return(stock_sell)\n                \n              }\n              \n            }\n            \n          }  \n          \n        }\n      } \n    }\n    \n    \n  }\n}\n\n\n\n\n\n\n\n\n####以下代码备用\n##用DEA价格分段判断下跌阶段\ndownByDEA <- function(stockID)\n{\n  \n  \n  \n  \n}\n\n\n\n\n\n##寻找向上突破均线的股票\ngetStockByBreakoutMA <- function(stockID,date_from,date_to)\n{\n  breakoutma_data <- w.wsd(stockID,\"breakout_ma\",date_from,date_to,\"meanLine=60;n=3\")$Data[,-1]\n  stock_breakoutma <- breakoutma_data[,breakoutma_data[nrow(breakoutma_data),]==TRUE]\n  return (names(stock_breakoutma))  \n}\n  \n\n\n\n##按MACD指标择股\ngetStockByMACD <- function(MACD_data)\n{\n  ##case1 取最近5个交易日，前4个交易日MACD<0,最后一个交易日MACD>0\n  group1 <- MACD_data[(nrow(MACD_data)-4):nrow(MACD_data),-1]\n  stock1 <- c()\n  for (i in 1:length(names(group1)))\n  {\n    group_temp <- group1[,names(group1)[i]]\n    if(group_temp[1]<0 & group_temp[2]<0 & group_temp[3]<0 & group_temp[4]<0 & group_temp[5]>0)\n    {\n      stock1 <- c(stock1,names(group1)[i])\n    }  \n  }\n  #View(stock1)\n  \n  \n\n  ##case2 最近5个交易日MACD均小于0，进入备选股票池\n  stock_option <- c()\n  for (i in 1:length(names(group1)))\n  {\n    group_temp <- group1[,names(group1)[i]]\n    if(group_temp[1]<0 & group_temp[2]<0 & group_temp[3]<0 & group_temp[4]<0 & group_temp[5]<0)\n    {\n      stock_option <- c(stock_option,names(group1)[i])\n    }  \n  }\n  #View(stock_option)\n\n  ##case3 最近两个交易日 MACD>0 且 MACD<1\n  group2 <- MACD_data[(nrow(MACD_data)-1):nrow(MACD_data),-1]\n  stock2 <- c()\n  for (i in 1:length(names(group2)))\n  {\n    group_temp <- group2[,names(group2)[i]]\n    if(group_temp[1]>0 & group_temp[2]>0 & group_temp[1]<0.3 & group_temp[2]<0.3)\n    {\n      stock2 <- c(stock2,names(group2)[i])\n    }  \n  }\n  #View(stock2)\n  \n\n  \n  stock_portfolio <- union(stock1,stock2)\n  return (stock_portfolio) \n   \n}\n\n\n\nbuyTimeByMinMACD <- function(stock_portfolio)\n{\n  \n  \n  \n}\n\n\n\n\n",
    "created" : 1514372272418.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4219043045",
    "id" : "F313F810",
    "lastKnownWriteTime" : 1513577682,
    "last_content_update" : 1513577682,
    "path" : "C:/Users/heyouxin/Desktop/presentation（v1.0）/源代码/strategy_function.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}